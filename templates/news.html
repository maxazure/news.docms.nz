<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ article.title }}</title>
    <meta name="description" content="{{ article.excerpt|default(article.title) }}">
    <meta name="keywords" content="{{ article.category|default('科技新闻') }},{{ article.title }}">
    <meta name="author" content="{{ article.author_name|default('news.docms.nz') }}">
    <meta name="robots" content="index, follow">
    <meta name="canonical" href="https://news.docms.nz/{{ article.slug }}">

    <!-- Open Graph -->
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://news.docms.nz/{{ article.slug }}">
    <meta property="og:locale" content="zh_CN">
    <meta property="og:site_name" content="news.docms.nz">
    <meta property="og:title" content="{{ article.title }}">
    <meta property="og:description" content="{{ article.excerpt|default(article.title) }}">
    <meta property="og:image" content="https://news.docms.nz/static/images/og-default.svg">

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@newsdocmsnz">
    <meta name="twitter:title" content="{{ article.title }}">
    <meta name="twitter:description" content="{{ article.excerpt|default(article.title) }}">
    <meta name="twitter:image" content="https://news.docms.nz/static/images/og-default.svg">

    <!-- Article Schema.org JSON-LD -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "NewsArticle",
        "headline": "{{ article.title }}",
        "description": "{{ article.excerpt|default(article.title) }}",
        "author": {
            "@type": "Organization",
            "name": "{{ article.author_name|default('news.docms.nz') }}",
            "url": "https://news.docms.nz"
        },
        "publisher": {
            "@type": "Organization",
            "name": "news.docms.nz",
            "logo": {
                "@type": "ImageObject",
                "url": "https://news.docms.nz/static/images/og-default.svg"
            }
        },
        "datePublished": "{{ article.published_at }}",
        "dateModified": "{{ article.updated_at|default(article.published_at) }}",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https://news.docms.nz/{{ article.slug }}"
        },
        "inLanguage": "zh-CN",
        "articleSection": "{{ article.category|default('科技新闻') }}",
        "wordCount": {{ article.content|length|default(0) }}
    }
    </script>

    <!-- Google Fonts: Newsreader (serif) + Roboto (sans) for reading optimization -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Newsreader:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500&family=Roboto:ital,wght@0,300;0,400;0,500;0,700;1,400&display=swap" rel="stylesheet">
    <style>
        /* 新闻详情页 - 业界标准可读性设计 */
        :root {
            --primary-color: #3B82F6;
            --primary-dark: #1E40AF;
            --text-primary: #1E293B;
            --text-secondary: #475569;
            --text-muted: #64748B;
            --bg-color: #F8FAFC;
            --card-bg: #FFFFFF;
            --border-color: #E2E8F0;
            --code-bg: #1E293B;
            --code-text: #E2E8F0;
            --quote-bg: #EFF6FF;
            --quote-border: #3B82F6;
            --font-serif: 'Newsreader', Georgia, 'Times New Roman', serif;
            --font-sans: 'Roboto', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        @media (prefers-reduced-motion: reduce) {
            html {
                scroll-behavior: auto;
            }
            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        body {
            font-family: var(--font-sans);
            line-height: 1.75;
            color: var(--text-primary);
            background-color: var(--bg-color);
            padding: 0;
            margin: 0;
        }

        /* 阅读进度条 */
        .reading-progress {
            position: fixed;
            top: 0;
            left: 0;
            width: 0%;
            height: 3px;
            background: linear-gradient(90deg, var(--primary-color), var(--primary-dark));
            z-index: 1000;
            transition: width 0.1s ease-out;
        }

        .article-container {
            max-width: 720px;
            margin: 0 auto;
            background: var(--card-bg);
            min-height: 100vh;
        }

        .article-header {
            padding: 40px 40px 20px;
        }

        .article-meta {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .category-tag {
            display: inline-block;
            padding: 4px 12px;
            background: var(--primary-color);
            color: white;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.025em;
        }

        .article-date {
            color: var(--text-muted);
            font-size: 0.875rem;
        }

        .reading-time {
            color: var(--text-muted);
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .reading-time svg {
            width: 16px;
            height: 16px;
        }

        /* 分享按钮 */
        .share-buttons {
            display: flex;
            gap: 8px;
            margin-top: 16px;
        }

        .share-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            transition: all 0.2s ease;
            padding: 0;
        }

        .share-btn svg {
            width: 18px;
            height: 18px;
            fill: white;
        }

        .share-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .share-btn.wechat {
            background: #07C160;
        }

        .share-btn.weibo {
            background: #E6162D;
        }

        .share-btn.twitter {
            background: #1DA1F2;
        }

        .share-btn.link {
            background: var(--text-secondary);
        }

        .share-btn.qrcode {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        /* QR 码模态框 */
        .qr-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .qr-modal.active {
            display: flex;
        }

        .qr-modal-content {
            background: white;
            border-radius: 16px;
            padding: 32px;
            text-align: center;
            max-width: 320px;
            width: 90%;
        }

        .qr-modal h3 {
            margin: 0 0 20px;
            font-size: 1.25rem;
            color: var(--text-primary);
        }

        .qr-code {
            width: 200px;
            height: 200px;
            margin: 0 auto 16px;
            background: var(--bg-secondary);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .qr-code canvas {
            border-radius: 8px;
        }

        .qr-url {
            font-size: 0.875rem;
            color: var(--text-muted);
            word-break: break-all;
        }

        .qr-close {
            margin-top: 20px;
            padding: 10px 24px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9375rem;
        }

        .qr-close:hover {
            background: var(--primary-dark);
        }

        /* 标题 - 业界标准排版 */
        h1.article-title {
            font-size: 2rem;
            font-weight: 700;
            line-height: 1.3;
            color: var(--text-primary);
            margin-bottom: 8px;
            letter-spacing: -0.02em;
        }

        .article-excerpt {
            font-size: 1.125rem;
            color: var(--text-secondary);
            line-height: 1.6;
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .article-content {
            padding: 20px 40px 60px;
            font-size: 1.0625rem;
            line-height: 1.8;
            color: var(--text-primary);
        }

        /* Markdown 内容样式 */
        .markdown-content h2 {
            font-size: 1.5rem;
            font-weight: 600;
            margin-top: 48px;
            margin-bottom: 16px;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--primary-color);
            color: var(--text-primary);
            line-height: 1.4;
        }

        .markdown-content h3 {
            font-size: 1.25rem;
            font-weight: 600;
            margin-top: 32px;
            margin-bottom: 12px;
            color: var(--text-primary);
            line-height: 1.4;
        }

        .markdown-content h4 {
            font-size: 1.0625rem;
            font-weight: 600;
            margin-top: 24px;
            margin-bottom: 10px;
            color: var(--text-secondary);
            line-height: 1.4;
        }

        .markdown-content p {
            margin-bottom: 1.25em;
            text-align: justify;
            text-justify: inter-word;
        }

        .markdown-content p:first-of-type {
            font-size: 1.125rem;
            line-height: 1.7;
        }

        /* 链接 */
        .markdown-content a {
            color: var(--primary-color);
            text-decoration: none;
            border-bottom: 1px solid transparent;
            transition: border-color 0.15s ease;
        }

        .markdown-content a:hover {
            border-bottom-color: var(--primary-color);
        }

        /* 列表 */
        .markdown-content ul,
        .markdown-content ol {
            margin: 1.25em 0;
            padding-left: 1.75em;
        }

        .markdown-content li {
            margin-bottom: 0.5em;
        }

        .markdown-content li::marker {
            color: var(--primary-color);
        }

        /* 引用 */
        .markdown-content blockquote {
            margin: 1.5em 0;
            padding: 16px 20px;
            background: var(--quote-bg);
            border-left: 4px solid var(--quote-border);
            border-radius: 0 8px 8px 0;
            color: var(--text-secondary);
            font-style: italic;
        }

        /* 代码 */
        .markdown-content code {
            font-family: 'JetBrains Mono', 'Fira Code', 'SF Mono', 'Consolas', monospace;
            font-size: 0.875em;
            background: var(--bg-color);
            padding: 2px 6px;
            border-radius: 4px;
            color: var(--primary-dark);
        }

        .markdown-content pre {
            margin: 1.5em 0;
            padding: 16px 20px;
            background: var(--code-bg);
            color: var(--code-text);
            border-radius: 8px;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        .markdown-content pre code {
            background: none;
            padding: 0;
            color: inherit;
            font-size: 0.875rem;
            line-height: 1.6;
        }

        /* 表格 */
        .markdown-content table {
            width: 100%;
            margin: 1.5em 0;
            border-collapse: collapse;
            font-size: 0.9375rem;
            overflow-x: auto;
            display: block;
        }

        .markdown-content th,
        .markdown-content td {
            padding: 12px 16px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        .markdown-content thead {
            background: var(--bg-color);
        }

        .markdown-content thead th {
            font-weight: 600;
            color: var(--text-primary);
            border-bottom: 2px solid var(--border-color);
        }

        .markdown-content tbody tr:hover {
            background: var(--bg-color);
        }

        /* 分隔线 */
        .markdown-content hr {
            border: none;
            height: 1px;
            background: var(--border-color);
            margin: 2.5em 0;
        }

        /* 加粗和斜体 */
        .markdown-content strong {
            font-weight: 600;
            color: var(--text-primary);
        }

        .markdown-content em {
            font-style: italic;
        }

        /* 图片 */
        .markdown-content img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            margin: 1.5em 0;
        }

        /* 返回链接 */
        .back-link {
            text-align: center;
            padding: 30px 20px;
            border-top: 1px solid var(--border-color);
        }

        .back-link a {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 0.9375rem;
            transition: color 0.15s ease;
        }

        .back-link a:hover {
            color: var(--primary-color);
        }

        /* 移动端响应式 */
        @media screen and (max-width: 768px) {
            .article-container {
                max-width: 100%;
            }

            .article-header {
                padding: 24px 20px 16px;
            }

            h1.article-title {
                font-size: 1.5rem;
            }

            .article-excerpt {
                font-size: 1rem;
            }

            .article-content {
                padding: 16px 20px 40px;
                font-size: 1rem;
            }

            .markdown-content h2 {
                font-size: 1.25rem;
                margin-top: 32px;
            }

            .markdown-content h3 {
                font-size: 1.125rem;
                margin-top: 24px;
            }

            .markdown-content h4 {
                font-size: 1rem;
            }

            .markdown-content pre {
                padding: 12px 16px;
                font-size: 0.8125rem;
                margin-left: -20px;
                margin-right: -20px;
                border-radius: 0;
            }

            .markdown-content table {
                font-size: 0.8125rem;
                margin-left: -20px;
                margin-right: -20px;
            }

            .markdown-content th,
            .markdown-content td {
                padding: 10px 12px;
            }

            .markdown-content ul,
            .markdown-content ol {
                padding-left: 1.5em;
            }

            .markdown-content p:first-of-type {
                font-size: 1rem;
            }

            .article-meta {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }
        }

        @media screen and (max-width: 480px) {
            .article-header {
                padding: 20px 16px 16px;
            }

            .article-content {
                padding: 16px;
            }

            h1.article-title {
                font-size: 1.375rem;
            }

            .markdown-content pre,
            .markdown-content table {
                margin-left: -16px;
                margin-right: -16px;
            }
        }

        /* 深色模式支持 */
        @media (prefers-color-scheme: dark) {
            :root {
                --primary-color: #60A5FA;
                --primary-dark: #3B82F6;
                --text-primary: #F1F5F9;
                --text-secondary: #CBD5E1;
                --text-muted: #94A3B8;
                --bg-color: #0F172A;
                --card-bg: #1E293B;
                --border-color: #334155;
                --code-bg: #0F172A;
                --code-text: #E2E8F0;
                --quote-bg: #1E3A5F;
                --quote-border: #60A5FA;
            }

            .markdown-content thead {
                background: #0F172A;
            }

            .markdown-content tbody tr:hover {
                background: #0F172A;
            }
        }

        /* 打印样式 */
        @media print {
            .article-header {
                padding: 20px;
            }

            .article-content {
                padding: 0;
            }

            .back-link {
                display: none;
            }
        }

        /* 返回顶部按钮 */
        .back-to-top {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: var(--primary-color);
            color: white;
            border: none;
            cursor: pointer;
            opacity: 0;
            visibility: hidden;
            transform: translateY(20px);
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .back-to-top.visible {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .back-to-top:hover {
            background: var(--primary-dark);
            transform: translateY(-4px);
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4);
        }

        .back-to-top svg {
            width: 24px;
            height: 24px;
        }

        @media screen and (max-width: 768px) {
            .back-to-top {
                bottom: 20px;
                right: 20px;
                width: 44px;
                height: 44px;
            }
        }

        /* 图片懒加载样式 */
        .markdown-content img[data-src] {
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .markdown-content img.loaded {
            opacity: 1;
        }

        .markdown-content img.loading {
            background: var(--bg-color);
            min-height: 200px;
        }

        /* 相关文章 */
        .related-articles {
            padding: 30px 40px 40px;
            border-top: 1px solid var(--border-color);
            background: var(--bg-color);
        }

        .related-articles h3 {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 20px;
            padding-left: 12px;
            border-left: 3px solid var(--primary-color);
        }

        .related-list {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
        }

        .related-item {
            display: block;
            background: var(--card-bg);
            border-radius: 8px;
            padding: 16px;
            text-decoration: none;
            transition: all 0.2s ease;
            border: 1px solid var(--border-color);
        }

        .related-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            border-color: var(--primary-color);
        }

        .related-category {
            display: inline-block;
            font-size: 0.6875rem;
            padding: 2px 8px;
            background: var(--primary-color);
            color: white;
            border-radius: 10px;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .related-item h4 {
            font-size: 0.9375rem;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0 0 8px;
            line-height: 1.4;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .related-date {
            font-size: 0.8125rem;
            color: var(--text-muted);
        }

        @media screen and (max-width: 768px) {
            .related-articles {
                padding: 20px;
            }

            .related-list {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="reading-progress" id="readingProgress"></div>

    <!-- 返回顶部按钮 -->
    <button class="back-to-top" id="backToTop" title="返回顶部" aria-label="返回顶部">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M18 15l-6-6-6 6"/>
        </svg>
    </button>

    <article class="article-container">
        <header class="article-header">
            <div class="article-meta">
                {% if article.get('category') %}
                <span class="category-tag">{{ article.category }}</span>
                {% endif %}
                {% if article.get('date') %}
                <span class="article-date">{{ article.date }}</span>
                {% endif %}
                <span class="reading-time" id="readingTime">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <polyline points="12 6 12 12 16 14"/>
                    </svg>
                    <span id="timeText">计算中...</span>
                </span>
            </div>
            <h1 class="article-title">{{ article.title }}</h1>
            {% if article.get('excerpt') %}
            <p class="article-excerpt">{{ article.excerpt }}</p>
            {% endif %}

            <!-- 分享按钮 -->
            <div class="share-buttons">
                <button class="share-btn wechat" onclick="shareTo('wechat')" title="分享到微信">
                    <svg viewBox="0 0 24 24"><path d="M8.691 2.188C3.891 2.188 0 5.476 0 9.53c0 2.212 1.17 4.203 3.002 5.55a.59.59 0 0 1 .213.665l-.39 1.48c-.019.07-.048.141-.048.213 0 .163.13.295.29.295a.326.326 0 0 0 .167-.054l1.903-1.114a.864.864 0 0 1 .717-.098 10.16 10.16 0 0 0 2.837.403c.276 0 .543-.027.811-.05-.857-2.578.157-4.972 1.932-6.446 1.703-1.415 3.882-1.98 5.853-1.838-.576-3.583-4.196-6.348-8.596-6.348zM5.785 5.991c.642 0 1.162.529 1.162 1.18a1.17 1.17 0 0 1-1.162 1.178A1.17 1.17 0 0 1 4.623 7.17c0-.651.52-1.18 1.162-1.18zm5.813 0c.642 0 1.162.529 1.162 1.18a1.17 1.17 0 0 1-1.162 1.178 1.17 1.17 0 0 1-1.162-1.178c0-.651.52-1.18 1.162-1.18zm5.34 2.867c-1.797-.052-3.746.512-5.28 1.786-1.72 1.428-2.687 3.72-1.78 6.22.942 2.453 3.666 4.229 6.884 4.229.826 0 1.622-.12 2.361-.336a.722.722 0 0 1 .598.082l1.584.926a.272.272 0 0 0 .14.047c.134 0 .24-.111.24-.247 0-.06-.023-.12-.038-.177l-.327-1.233a.582.582 0 0 1-.023-.156.49.49 0 0 1 .201-.398C23.024 18.48 24 16.82 24 14.98c0-3.21-2.931-5.837-6.656-6.088V8.89l-.006-.033zm-2.634 2.588c.535 0 .969.44.969.982a.976.976 0 0 1-.969.983.976.976 0 0 1-.969-.983c0-.542.434-.982.97-.982zm4.844 0c.535 0 .969.44.969.982a.976.976 0 0 1-.969.983.976.976 0 0 1-.969-.983c0-.542.434-.982.97-.982z"/></svg>
                </button>
                <button class="share-btn weibo" onclick="shareTo('weibo')" title="分享到微博">
                    <svg viewBox="0 0 24 24"><path d="M10.098 20c-4.27 0-8.598-1.85-8.598-5.77 0-1.64.65-3.14 1.74-4.31-.24-1.23.18-2.7 1.18-3.51 1.2-.97 3.04-.58 3.85.44.42-.13.87-.2 1.33-.2 2.24 0 4.16 1.58 4.66 3.74.77-.43 1.68-.67 2.64-.67 3.29 0 6 2.38 6 5.25 0 1.33-.62 2.54-1.6 3.44-.98.9-2.3 1.42-3.65 1.42-.34 0-.68-.03-1.01-.09-1.05 1.33-2.42 2.17-4.05 2.17-1.21 0-2.33-.38-3.27-1.04a5.067 5.067 0 0 1-2.2 2.01c1.31.4 2.72.63 4.22.63 4.27 0 8.11-1.85 8.11-5.33 0-1.94-.87-3.69-2.24-4.89.76-.47 1.37-1.18 1.7-2.01-.84.33-1.75.51-2.71.51-.67 0-1.31-.09-1.92-.25-1.4 1.61-3.25 2.65-5.29 2.65-1.93 0-3.67-.73-4.92-1.91-.69.39-1.49.61-2.33.61-.22 0-.43-.01-.64-.04-.09 1.21.23 2.41.88 3.31.66.9 1.62 1.46 2.72 1.56-.04-2.43 1.79-4.52 4.31-5.01.36-.07.73-.1 1.09-.1.67 0 1.32.09 1.93.25-.26-1.32.19-2.66.95-3.63 1.07-1.37 2.9-1.91 4.58-1.56.26.05.5.13.73.23-.04-1.73 1.18-3.3 2.82-3.79.34-.1.69-.15 1.04-.15 1.32 0 2.53.58 3.31 1.48.14-.04.28-.07.43-.07.64 0 1.24.23 1.69.64.46.41.71 1 .62 1.61-.09.61-.48 1.14-1.02 1.39.62-.18 1.17-.6 1.5-1.16.43-.71.46-1.57.05-2.32-.4-.75-1.13-1.25-1.96-1.32-.27-.02-.54-.02-.8 0C14.166 2.088 11.586 1 8.824 1c-.58 0-1.14.07-1.69.2-1.2.28-2.25.97-3 1.92-.5.64-.82 1.4-.91 2.21-.13 1.15.16 2.28.79 3.17.63.89 1.58 1.46 2.64 1.59.3.04.6.05.9.05 1.19 0 2.31-.42 3.21-1.15.9-.73 1.55-1.74 1.87-2.91.21-.77.24-1.58.09-2.36-.16-.78-.52-1.5-1.02-2.1-.5-.6-1.15-1.05-1.87-1.3-.72-.25-1.5-.33-2.25-.23-1.27.17-2.35.84-3.03 1.88-.49.75-.76 1.63-.76 2.53 0 .62.14 1.23.4 1.79.26.56.63 1.04 1.09 1.41.46.37 1 .64 1.59.79.59.15 1.21.18 1.81.08 1.2-.19 2.27-.79 3.04-1.68.77-.89 1.22-1.99 1.28-3.13.03-.58-.05-1.16-.22-1.7zm-4.79 2.72c-.48 0-.87-.4-.87-.9 0-.5.39-.91.87-.91.48 0 .87.41.87.91 0 .5-.39.9-.87.9zm4.8 0c-.48 0-.87-.4-.87-.9 0-.5.39-.91.87-.91.48 0 .87.41.87.91 0 .5-.39.9-.87.9z"/></svg>
                </button>
                <button class="share-btn twitter" onclick="shareTo('twitter')" title="分享到 Twitter">
                    <svg viewBox="0 0 24 24"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
                </button>
                <button class="share-btn link" onclick="shareTo('copy')" title="复制链接">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/>
                        <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/>
                    </svg>
                </button>
                <button class="share-btn qrcode" onclick="showQRCode()" title="二维码分享">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="7" height="7"/>
                        <rect x="14" y="3" width="7" height="7"/>
                        <rect x="3" y="14" width="7" height="7"/>
                        <rect x="14" y="14" width="4" height="4"/>
                        <rect x="17" y="17" width="4" height="4"/>
                    </svg>
                </button>
            </div>
        </header>

        <div class="article-content">
            <div class="markdown-content">
                {% if article.get('html_content') %}
                    {{ article.html_content|safe }}
                {% else %}
                    {{ article.content|safe }}
                {% endif %}
            </div>
        </div>

        <div class="back-link">
            <a href="/">← 返回首页</a>
        </div>

        <!-- 相关文章 -->
        {% if related_articles %}
        <div class="related-articles">
            <h3>相关文章</h3>
            <div class="related-list">
                {% for related in related_articles %}
                <a href="/{{ related.slug }}" class="related-item">
                    <div class="related-content">
                        <span class="related-category">{{ related.category_name or '未分类' }}</span>
                        <h4>{{ related.title }}</h4>
                        <span class="related-date">{{ related.published_at[:10] if related.published_at else '' }}</span>
                    </div>
                </a>
                {% endfor %}
            </div>
        </div>
        {% endif %}
    </article>

    <!-- QR 码模态框 -->
    <div class="qr-modal" id="qrModal">
        <div class="qr-modal-content">
            <h3>扫码分享</h3>
            <div class="qr-code" id="qrCodeContainer"></div>
            <p class="qr-url" id="qrUrl"></p>
            <button class="qr-close" onclick="closeQRCode()">关闭</button>
        </div>
    </div>

    <!-- QRCode.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <script>
        // 阅读进度条
        (function() {
            const progressBar = document.getElementById('readingProgress');
            if (!progressBar) return;

            function updateProgress() {
                const scrollTop = window.scrollY || document.documentElement.scrollTop;
                const scrollHeight = document.documentElement.scrollHeight - window.innerHeight;
                const progress = (scrollTop / scrollHeight) * 100;
                progressBar.style.width = Math.min(100, Math.max(0, progress)) + '%';
            }

            window.addEventListener('scroll', updateProgress, { passive: true });
            updateProgress();
        })();

        // 计算阅读时间 (中文字符约 300 字/分钟，英文约 200 字/分钟)
        (function() {
            const content = document.querySelector('.markdown-content');
            const timeText = document.getElementById('timeText');
            if (!content || !timeText) return;

            const text = content.textContent || content.innerText;
            // 中文字符按 0.4 字计算，英文按 1 字计算
            const chineseChars = (text.match(/[\u4e00-\u9fa5]/g) || []).length;
            const otherChars = text.length - chineseChars;
            const words = Math.ceil(chineseChars * 0.4 + otherChars);
            const minutes = Math.max(1, Math.ceil(words / 300));

            timeText.textContent = minutes + ' 分钟阅读';
        })();

        // 分享功能
        function shareTo(platform) {
            const url = encodeURIComponent(window.location.href);
            const title = encodeURIComponent(document.title);

            switch(platform) {
                case 'wechat':
                    // 微信分享需要使用 JS-SDK，这里显示提示
                    alert('请使用微信扫一扫页面右上角分享按钮分享');
                    break;
                case 'weibo':
                    window.open(`https://service.weibo.com/share/share.php?url=${url}&title=${title}`, '_blank');
                    break;
                case 'twitter':
                    window.open(`https://twitter.com/intent/tweet?url=${url}&text=${title}`, '_blank');
                    break;
                case 'copy':
                    navigator.clipboard.writeText(window.location.href).then(() => {
                        alert('链接已复制到剪贴板');
                    }).catch(() => {
                        // 降级方案
                        const textarea = document.createElement('textarea');
                        textarea.value = window.location.href;
                        document.body.appendChild(textarea);
                        textarea.select();
                        document.execCommand('copy');
                        document.body.removeChild(textarea);
                        alert('链接已复制到剪贴板');
                    });
                    break;
            }
        }

        // QR 码功能
        function showQRCode() {
            const modal = document.getElementById('qrModal');
            const container = document.getElementById('qrCodeContainer');
            const urlText = document.getElementById('qrUrl');

            if (!modal || !container || !window.QRCode) {
                alert('二维码加载中，请稍候...');
                return;
            }

            const url = window.location.href;
            urlText.textContent = url;

            // 清空之前的二维码
            container.innerHTML = '';

            // 生成二维码
            try {
                QRCode.toCanvas(url, {
                    width: 200,
                    height: 200,
                    margin: 2,
                    color: {
                        dark: '#1E293B',
                        light: '#FFFFFF'
                    }
                }, function(error, canvas) {
                    if (error) {
                        console.error(error);
                        container.innerHTML = '<span style="color: #999;">生成失败</span>';
                        return;
                    }
                    canvas.style.borderRadius = '8px';
                    container.appendChild(canvas);
                });
            } catch (e) {
                container.innerHTML = '<span style="color: #999;">生成失败</span>';
            }

            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeQRCode() {
            const modal = document.getElementById('qrModal');
            if (modal) {
                modal.classList.remove('active');
                document.body.style.overflow = '';
            }
        }

        // 点击模态框外部关闭
        document.getElementById('qrModal')?.addEventListener('click', function(e) {
            if (e.target === this) {
                closeQRCode();
            }
        });

        // ESC 键关闭
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeQRCode();
            }
        });

        // 返回顶部按钮
        (function() {
            const backToTop = document.getElementById('backToTop');
            if (!backToTop) return;

            function updateBackToTop() {
                if (window.scrollY > 300) {
                    backToTop.classList.add('visible');
                } else {
                    backToTop.classList.remove('visible');
                }
            }

            backToTop.addEventListener('click', function() {
                window.scrollTo({
                    top: 0,
                    behavior: 'smooth'
                });
            });

            window.addEventListener('scroll', updateBackToTop, { passive: true });
            updateBackToTop();
        })();

        // 图片懒加载
        (function() {
            const images = document.querySelectorAll('.markdown-content img');

            if ('IntersectionObserver' in window) {
                const imageObserver = new IntersectionObserver(function(entries, observer) {
                    entries.forEach(function(entry) {
                        if (entry.isIntersecting) {
                            const img = entry.target;
                            img.src = img.dataset.src || img.src;
                            img.onload = function() {
                                img.classList.add('loaded');
                            };
                            img.onerror = function() {
                                img.classList.add('loaded');
                            };
                            observer.unobserve(img);
                        }
                    });
                }, {
                    rootMargin: '50px 0px',
                    threshold: 0.01
                });

                images.forEach(function(img) {
                    img.classList.add('loading');
                    imageObserver.observe(img);
                });
            } else {
                // 降级方案：直接加载
                images.forEach(function(img) {
                    img.src = img.dataset.src || img.src;
                    img.classList.add('loaded');
                });
            }
        })();
    </script>
</body>
</html>
