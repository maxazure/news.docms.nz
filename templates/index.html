<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÁßëÊäÄÊñ∞Èóª - news.docms.nz</title>
    <meta name="description" content="ÁßëÊäÄÊñ∞ÈóªÂπ≥Âè∞ - Êèê‰æõÊúÄÊñ∞ÁöÑÊäÄÊúØËµÑËÆØ„ÄÅ‰∫ßÂìÅÂàÜÊûêÂíåË°å‰∏öÊä•Âëä">
    <meta name="keywords" content="ÁßëÊäÄÊñ∞Èóª,ÊäÄÊúØËµÑËÆØ,‰∫ßÂìÅÂàÜÊûê,Ë°å‰∏öÊä•Âëä">
    <meta name="author" content="news.docms.nz">
    <!-- Open Graph -->
    <meta property="og:title" content="ÁßëÊäÄÊñ∞Èóª - news.docms.nz">
    <meta property="og:description" content="ÁßëÊäÄÊñ∞ÈóªÂπ≥Âè∞ - Êèê‰æõÊúÄÊñ∞ÁöÑÊäÄÊúØËµÑËÆØ„ÄÅ‰∫ßÂìÅÂàÜÊûêÂíåË°å‰∏öÊä•Âëä">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://news.docms.nz">
    <meta property="og:locale" content="zh_CN">
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="ÁßëÊäÄÊñ∞Èóª - news.docms.nz">
    <meta name="twitter:description" content="ÁßëÊäÄÊñ∞ÈóªÂπ≥Âè∞ - Êèê‰æõÊúÄÊñ∞ÁöÑÊäÄÊúØËµÑËÆØ„ÄÅ‰∫ßÂìÅÂàÜÊûêÂíåË°å‰∏öÊä•Âëä">
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üì∞</text></svg>">
    <link rel="stylesheet" href="/static/css/main.css">
    <link rel="stylesheet" href="/static/css/admin.css">
</head>
<body>
{% raw %}
<div id="app">
    <!-- Âä†ËΩΩÁä∂ÊÄÅ -->
    <div v-if="loading" class="loading-overlay">
        <div class="loading-spinner"></div>
    </div>

    <!-- ÈòÖËØªËøõÂ∫¶Êù° -->
    <div class="reading-progress" :style="{ width: readingProgress + '%' }" v-if="currentPage === 'article'"></div>

    <!-- Toast ÈÄöÁü•ÂÆπÂô® -->
    <div class="toast-container">
        <div v-for="toast in toasts" :key="toast.id" class="toast" :class="toast.type">
            <div class="toast-content">
                <div class="toast-title">[[toast.title]]</div>
                <div class="toast-message">[[toast.message]]</div>
            </div>
            <button @click="removeToast(toast.id)" class="toast-close">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                </svg>
            </button>
        </div>
    </div>

    <header class="header">
        <div class="container">
            <a href="/" class="logo">
                <span class="logo-icon"></span>
                ÁßëÊäÄÊñ∞Èóª
            </a>
            <button class="mobile-menu-toggle" @click="mobileMenuOpen = !mobileMenuOpen">
                <span></span>
                <span></span>
                <span></span>
            </button>
            <nav class="nav" :class="{ 'mobile-open': mobileMenuOpen }">
                <a href="/">È¶ñÈ°µ</a>
                <template v-if="isLoggedIn">
                    <a href="/admin" v-if="isAdmin">ÁÆ°ÁêÜÂêéÂè∞</a>
                    <a href="/profile">‰∏™‰∫∫‰∏≠ÂøÉ</a>
                    <span class="username">[[user?.username || '']]</span>
                    <a href="#" @click.prevent="logout">ÈÄÄÂá∫</a>
                </template>
                <template v-else>
                    <a href="/login">ÁôªÂΩï</a>
                    <a href="/register">Ê≥®ÂÜå</a>
                </template>
            </nav>
        </div>
    </header>

    <main class="main">
        <div class="container">
            <!-- È¶ñÈ°µ - ÊñáÁ´†ÂàóË°® -->
            <div class="home-page" v-if="currentPage === 'home'">
                <!-- Hero Âå∫Âüü -->
                <div class="hero-section">
                    <h1>ÁßëÊäÄÊñ∞ÈóªÂàÜ‰∫´Âπ≥Âè∞</h1>
                    <p>Êé¢Á¥¢ÊúÄÊñ∞ÁöÑÊäÄÊúØËµÑËÆØ„ÄÅ‰∫ßÂìÅÂàÜÊûêÂíåË°å‰∏öË∂ãÂäø</p>
                    <div class="hero-stats">
                        <div class="hero-stat">
                            <div class="hero-stat-value">[[stats.total_articles || 0]]</div>
                            <div class="hero-stat-label">ÁØáÊñáÁ´†</div>
                        </div>
                        <div class="hero-stat">
                            <div class="hero-stat-value">[[categories.length || 0]]</div>
                            <div class="hero-stat-label">‰∏™ÂàÜÁ±ª</div>
                        </div>
                        <div class="hero-stat">
                            <div class="hero-stat-value">[[stats.total_users || 0]]</div>
                            <div class="hero-stat-label">‰ΩçÁî®Êà∑</div>
                        </div>
                    </div>
                </div>

                <!-- ÊêúÁ¥¢Ê°Ü -->
                <div class="search-box" style="position: relative;">
                    <input type="text" id="search-input" name="search" v-model="searchQuery" @input="handleSearchInput"
                           @keyup.enter="handleSearch" @focus="showSearchSuggestions = true"
                           placeholder="ÊêúÁ¥¢ÊñáÁ´†Ê†áÈ¢òÊàñÂÜÖÂÆπ..." class="search-input" autocomplete="off">
                    <button @click="handleSearch" class="search-btn">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
                        </svg>
                    </button>
                    <button v-if="searchQuery" @click="clearSearch" class="clear-btn" title="Ê∏ÖÈô§ÊêúÁ¥¢">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                        </svg>
                    </button>
                    <!-- ÊêúÁ¥¢Âª∫ËÆÆ -->
                    <div class="search-suggestions" v-if="showSearchSuggestions && searchSuggestions.length > 0">
                        <div v-for="suggestion in searchSuggestions" :key="suggestion.slug"
                             class="suggestion-item" @click="selectSuggestion(suggestion)">
                            <div class="suggestion-title">[[suggestion.title]]</div>
                            <div class="suggestion-meta">[[suggestion.category_name]] ¬∑ [[formatDate(suggestion.published_at)]]</div>
                        </div>
                    </div>
                </div>

                <!-- ÂàÜÁ±ªÁ≠õÈÄâ -->
                <div class="category-filter" v-if="categories.length > 0">
                    <button @click="filterByCategory(null)" :class="{ active: !selectedCategory }" class="category-btn">ÂÖ®ÈÉ®</button>
                    <button v-for="cat in categories" :key="cat.id" @click="filterByCategory(cat.id)"
                            :class="{ active: selectedCategory === cat.id }" class="category-btn">
                        [[cat.name]]
                    </button>
                </div>

                <!-- ÂàÜÁ±ªÁ£ÅË¥¥ -->
                <div class="category-tiles" v-if="categories.length > 0">
                    <div class="category-tile" :class="{ active: !selectedCategory }" @click="filterByCategory(null)">
                        <div class="category-tile-icon">üìö</div>
                        <div class="category-tile-name">ÂÖ®ÈÉ®</div>
                    </div>
                    <div v-for="cat in categories" :key="cat.id" class="category-tile"
                         :class="{ active: selectedCategory === cat.id }" @click="filterByCategory(cat.id)">
                        <div class="category-tile-icon">üìÅ</div>
                        <div class="category-tile-name">[[cat.name]]</div>
                    </div>
                </div>

                <!-- ÊñáÁ´†ÂàóË°® -->
                <div class="article-list" v-if="articles && articles.length > 0">
                    <article class="article-card" v-for="article in articles" :key="article.id">
                        <div class="article-card-header">
                            <span v-if="article.category_name" class="category-tag">[[article.category_name]]</span>
                            <div class="article-meta">
                                <span v-if="article.author_name" class="author">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                                    </svg>
                                    [[article.author_name]]
                                </span>
                                <span class="article-date">[[formatDate(article.published_at)]]</span>
                                <span class="read-time">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z"/>
                                    </svg>
                                    [[calculateReadTime(article.content)]]
                                </span>
                            </div>
                        </div>
                        <h2><a :href="'/article/' + article.slug">[[article.title]]</a></h2>
                        <p class="article-excerpt">[[article.excerpt]]</p>
                        <div class="article-tags" v-if="article.tags && article.tags.length > 0">
                            <span v-for="tag in article.tags.split(',').slice(0, 3)" :key="tag" class="tag">[[tag.trim()]]</span>
                        </div>
                        <div class="article-meta" style="margin-top: 12px;">
                            <span class="views">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>
                                </svg>
                                [[article.view_count]] ÈòÖËØª
                            </span>
                        </div>
                        <a :href="'/article/' + article.slug" class="btn btn-primary btn-small">ÈòÖËØªÂÖ®Êñá</a>
                    </article>
                </div>
                <div v-else class="no-articles">
                    <div class="empty-state">
                        <svg width="64" height="64" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/>
                        </svg>
                        <p>ÊöÇÊó†ÊñáÁ´†</p>
                    </div>
                </div>

                <!-- ÂàÜÈ°µ -->
                <div class="pagination" v-if="totalPages > 1">
                    <a v-if="currentPageNum > 1" href="#" @click.prevent="goToPage(currentPageNum - 1)">‰∏ä‰∏ÄÈ°µ</a>
                    <span v-for="page in Math.min(5, totalPages)" :key="page"
                          :class="{ active: page === currentPageNum }"
                          @click.prevent="goToPage(page)">
                        [[page]]
                    </span>
                    <span v-if="totalPages > 5">...</span>
                    <a v-if="currentPageNum < totalPages" href="#" @click.prevent="goToPage(currentPageNum + 1)">‰∏ã‰∏ÄÈ°µ</a>
                </div>
            </div>

            <!-- ÊñáÁ´†ËØ¶ÊÉÖÈ°µ -->
            <div class="article-detail-page" v-else-if="currentPage === 'article'">
                <div v-if="article" class="article-detail">
                    <div class="article-header">
                        <span v-if="article.category_name" class="category-tag large">[[article.category_name]]</span>
                        <h1>[[article.title]]</h1>
                        <div class="article-meta-full">
                            <span v-if="article.author_name" class="author">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                                </svg>
                                [[article.author_name]]
                            </span>
                            <span class="date">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z"/>
                                </svg>
                                [[formatFullDate(article.published_at)]]
                            </span>
                            <span class="read-time">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z"/>
                                </svg>
                                [[calculateReadTime(article.content)]]
                            </span>
                            <span class="views">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>
                                </svg>
                                [[article.view_count]] ÈòÖËØª
                            </span>
                        </div>
                        <!-- Ê†áÁ≠æ -->
                        <div class="article-tags" v-if="article.tags && article.tags.length > 0" style="margin-top: 16px;">
                            <span v-for="tag in article.tags.split(',')" :key="tag" class="tag primary">[[tag.trim()]]</span>
                        </div>
                    </div>

                    <!-- ÊñáÁ´†ÁõÆÂΩï -->
                    <div class="table-of-contents" v-if="tocItems.length > 0">
                        <h3>ÁõÆÂΩï</h3>
                        <ul class="toc-list">
                            <li v-for="item in tocItems" :key="item.id">
                                <a :href="'#' + item.id" :class="{ 'toc-h3': item.level === 3, 'active': activeToc === item.id }"
                                   @click.prevent="scrollToHeading(item.id)">[[item.text]]</a>
                            </li>
                        </ul>
                    </div>

                    <div class="article-content" v-html="article.html_content" ref="articleContent"></div>

                    <!-- ÂàÜ‰∫´ÊåâÈíÆ -->
                    <div class="share-buttons">
                        <button class="share-btn" @click="shareArticle('weibo')" title="ÂàÜ‰∫´Âà∞ÂæÆÂçö">
                            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M20 9.5c-.7 0-1.4.1-2 .3 1.4-1.4 2.1-3.2 1.9-4.8-2.1.1-4.5 1.2-5.9 3-1.1 1.4-1.6 3.1-1.5 4.9.1 1.8 1 3.4 2.5 4.5-.6-.3-1.2-.7-1.8-1.2-.9-.8-1.5-1.8-1.8-3-.3-1.2 0-2.4.7-3.4.6-.9 1.5-1.6 2.5-1.9.4-2.5 2.4-4.4 5-4.4h.7c1.2 0 2.4.5 3.2 1.4.6.7 1 1.6 1 2.5 0 .2 0 .5-.1.7.7-.1 1.4-.2 2-.2zM3.5 15c-.4 0-.8-.1-1.1-.4-.9-.8-1-2.2-.2-3.5.6-1 1.6-1.7 2.7-1.9 1.1-2.5 3.4-4.2 6-4.2 1.2 0 2.4.3 3.4 1 1.2.8 2 2 2.2 3.4.1.6 0 1.2-.2 1.8-.6-1.1-1.5-2-2.6-2.6-.2-.1-.4-.2-.6-.2-1.5.1-2.8 1-3.7 2.2-.8 1.1-1.1 2.4-.8 3.7.4 1.4 1.5 2.6 2.9 3.2-.4-.7-.5-1.5-.3-2.3.2-.8.8-1.5 1.6-1.9.8-.4 1.7-.4 2.5 0 .5.3.9.7 1.1 1.2.3-.5.4-1 .4-1.6 0-1.6-.9-3.1-2.3-3.9-.8-.5-1.8-.7-2.7-.6-1.4.1-2.7.9-3.4 2.1-.6 1-1 2.2-.9 3.4 0 .5.1 1 .4 1.4-1.6.4-2.7 1.7-2.9 3.3-.1.7 0 1.4.4 2z"/></svg>
                        </button>
                        <button class="share-btn" @click="shareArticle('twitter')" title="ÂàÜ‰∫´Âà∞ Twitter">
                            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
                        </button>
                        <button class="share-btn" @click="shareArticle('link')" title="Â§çÂà∂ÈìæÊé•">
                            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"/></svg>
                        </button>
                    </div>

                    <!-- ÊñáÁ´†Êìç‰ΩúÊ†è -->
                    <div class="article-toolbar">
                        <div class="article-nav-links">
                            <a href="/" class="article-nav-link">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>
                                ËøîÂõûÈ¶ñÈ°µ
                            </a>
                        </div>
                        <button @click="scrollToTop" class="btn btn-secondary btn-small">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"/></svg>
                            ÂõûÂà∞È°∂ÈÉ®
                        </button>
                    </div>
                </div>
                <div v-else class="loading">
                    <div class="loading-spinner"></div>
                </div>
            </div>

            <!-- ÁôªÂΩïÈ°µ -->
            <div class="auth-page" v-else-if="currentPage === 'login'">
                <div class="auth-card">
                    <div class="auth-header">
                        <h1>ÁôªÂΩï</h1>
                        <p>Ê¨¢ËøéÂõûÊù•</p>
                    </div>
                    <div v-if="error" class="error-message">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
                        </svg>
                        [[error]]
                    </div>
                    <div v-if="successMessage" class="success-message">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
                        </svg>
                        [[successMessage]]
                    </div>
                    <form @submit.prevent="handleLogin">
                        <div class="form-group">
                            <label>Áî®Êà∑ÂêçÊàñÈÇÆÁÆ±</label>
                            <input type="text" id="login-username" name="username" v-model="loginForm.username" class="form-control" placeholder="ËØ∑ËæìÂÖ•Áî®Êà∑ÂêçÊàñÈÇÆÁÆ±" required autocomplete="username">
                        </div>
                        <div class="form-group">
                            <label>ÂØÜÁ†Å</label>
                            <input type="password" id="login-password" name="password" v-model="loginForm.password" class="form-control" placeholder="ËØ∑ËæìÂÖ•ÂØÜÁ†Å" required autocomplete="current-password">
                        </div>
                        <button type="submit" class="btn btn-primary btn-block" :disabled="submitting">
                            <span v-if="submitting">ÁôªÂΩï‰∏≠...</span>
                            <span v-else>ÁôªÂΩï</span>
                        </button>
                    </form>
                    <div class="auth-links">
                        <p>ËøòÊ≤°ÊúâË¥¶Âè∑Ôºü<a href="/register">Á´ãÂç≥Ê≥®ÂÜå</a></p>
                        <p><a href="/">ËøîÂõûÈ¶ñÈ°µ</a></p>
                    </div>
                </div>
            </div>

            <!-- Ê≥®ÂÜåÈ°µ -->
            <div class="auth-page" v-else-if="currentPage === 'register'">
                <div class="auth-card">
                    <div class="auth-header">
                        <h1>Ê≥®ÂÜå</h1>
                        <p>ÂàõÂª∫Êñ∞Ë¥¶Âè∑</p>
                    </div>
                    <div v-if="error" class="error-message">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
                        </svg>
                        [[error]]
                    </div>
                    <div v-if="successMessage" class="success-message">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
                        </svg>
                        [[successMessage]]
                    </div>
                    <form @submit.prevent="handleRegister">
                        <div class="form-group">
                            <label>Áî®Êà∑Âêç</label>
                            <input type="text" id="register-username" name="username" v-model="registerForm.username" class="form-control" placeholder="ËØ∑ËæìÂÖ•Áî®Êà∑Âêç" required autocomplete="username">
                        </div>
                        <div class="form-group">
                            <label>ÈÇÆÁÆ±</label>
                            <input type="email" id="register-email" name="email" v-model="registerForm.email" class="form-control" placeholder="ËØ∑ËæìÂÖ•ÈÇÆÁÆ±" required autocomplete="email">
                        </div>
                        <div class="form-group">
                            <label>ÂØÜÁ†Å</label>
                            <input type="password" id="register-password" name="password" v-model="registerForm.password" class="form-control" placeholder="Ëá≥Â∞ë8‰ΩçÂ≠óÁ¨¶" required minlength="8" autocomplete="new-password">
                        </div>
                        <button type="submit" class="btn btn-primary btn-block" :disabled="submitting">
                            <span v-if="submitting">Ê≥®ÂÜå‰∏≠...</span>
                            <span v-else>Ê≥®ÂÜå</span>
                        </button>
                    </form>
                    <div class="auth-links">
                        <p>Â∑≤ÊúâË¥¶Âè∑Ôºü<a href="/login">Á´ãÂç≥ÁôªÂΩï</a></p>
                        <p><a href="/">ËøîÂõûÈ¶ñÈ°µ</a></p>
                    </div>
                </div>
            </div>

            <!-- ‰∏™‰∫∫‰∏≠ÂøÉ -->
            <div class="profile-page" v-else-if="currentPage === 'profile'">
                <div class="profile-card" v-if="user">
                    <div class="profile-header">
                        <div class="avatar">[[user.username.charAt(0).toUpperCase()]]</div>
                        <h1>[[user.username]]</h1>
                        <span class="role-badge" :class="user.role">[[user.role === 'admin' ? 'ÁÆ°ÁêÜÂëò' : 'ÊôÆÈÄöÁî®Êà∑']]</span>
                    </div>
                    <div class="profile-info">
                        <div class="info-item">
                            <label>Áî®Êà∑Âêç</label>
                            <span>[[user.username]]</span>
                        </div>
                        <div class="info-item">
                            <label>ÈÇÆÁÆ±</label>
                            <span>[[user.email]]</span>
                        </div>
                        <div class="info-item">
                            <label>ËßíËâ≤</label>
                            <span>[[user.role === 'admin' ? 'ÁÆ°ÁêÜÂëò' : 'ÊôÆÈÄöÁî®Êà∑']]</span>
                        </div>
                        <div class="info-item">
                            <label>Ê≥®ÂÜåÊó∂Èó¥</label>
                            <span>[[formatFullDate(user.created_at)]]</span>
                        </div>
                    </div>
                    <div class="profile-actions">
                        <button @click="logout" class="btn btn-danger">ÈÄÄÂá∫ÁôªÂΩï</button>
                        <a href="/" class="btn btn-secondary">ËøîÂõûÈ¶ñÈ°µ</a>
                    </div>
                </div>
            </div>

            <!-- ÁÆ°ÁêÜÂêéÂè∞ -->
            <div class="admin-page" v-else-if="currentPage === 'admin'">
                <div class="admin-layout">
                    <!-- ‰æßËæπÊ†è -->
                    <aside class="admin-sidebar">
                        <div class="sidebar-header">
                            <h2>ÁÆ°ÁêÜÂêéÂè∞</h2>
                        </div>
                        <nav class="sidebar-nav">
                            <a @click="adminSection = 'dashboard'" :class="{ active: adminSection === 'dashboard' }">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z"/></svg>
                                ‰ª™Ë°®Áõò
                            </a>
                            <a @click="adminSection = 'articles'" :class="{ active: adminSection === 'articles' }">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/></svg>
                                ÊñáÁ´†ÁÆ°ÁêÜ
                            </a>
                            <a @click="adminSection = 'categories'" :class="{ active: adminSection === 'categories' }">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M10 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z"/></svg>
                                ÂàÜÁ±ªÁÆ°ÁêÜ
                            </a>
                            <a @click="adminSection = 'users'" :class="{ active: adminSection === 'users' }">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"/></svg>
                                Áî®Êà∑ÁÆ°ÁêÜ
                            </a>
                        </nav>
                    </aside>

                    <!-- ‰∏ªÂÜÖÂÆπÂå∫ -->
                    <main class="admin-content">
                        <!-- ‰ª™Ë°®Áõò -->
                        <div v-if="adminSection === 'dashboard'" class="admin-section">
                            <h1>‰ª™Ë°®Áõò</h1>
                            <div class="stats-grid">
                                <div class="stat-card">
                                    <div class="stat-icon blue">
                                        <svg width="32" height="32" viewBox="0 0 24 24" fill="currentColor"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/></svg>
                                    </div>
                                    <div class="stat-info">
                                        <span class="stat-value">[[stats.total_articles]]</span>
                                        <span class="stat-label">ÊñáÁ´†ÊÄªÊï∞</span>
                                    </div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-icon green">
                                        <svg width="32" height="32" viewBox="0 0 24 24" fill="currentColor"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>
                                    </div>
                                    <div class="stat-info">
                                        <span class="stat-value">[[stats.published_articles]]</span>
                                        <span class="stat-label">Â∑≤ÂèëÂ∏É</span>
                                    </div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-icon orange">
                                        <svg width="32" height="32" viewBox="0 0 24 24" fill="currentColor"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/></svg>
                                    </div>
                                    <div class="stat-info">
                                        <span class="stat-value">[[stats.draft_articles]]</span>
                                        <span class="stat-label">ËçâÁ®ø</span>
                                    </div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-icon purple">
                                        <svg width="32" height="32" viewBox="0 0 24 24" fill="currentColor"><path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5z"/></svg>
                                    </div>
                                    <div class="stat-info">
                                        <span class="stat-value">[[stats.total_users]]</span>
                                        <span class="stat-label">Áî®Êà∑Êï∞</span>
                                    </div>
                                </div>
                            </div>
                            <div class="recent-articles">
                                <h2>ÊúÄÊñ∞ÊñáÁ´†</h2>
                                <div class="article-list-simple" v-if="recentArticles.length > 0">
                                    <div v-for="article in recentArticles" :key="article.id" class="article-item-simple">
                                        <span class="article-title">[[article.title]]</span>
                                        <span class="article-status" :class="article.status">[[article.status === 'published' ? 'Â∑≤ÂèëÂ∏É' : 'ËçâÁ®ø']]</span>
                                        <span class="article-date">[[formatFullDate(article.created_at)]]</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- ÊñáÁ´†ÁÆ°ÁêÜ -->
                        <div v-else-if="adminSection === 'articles'" class="admin-section">
                            <div class="section-header">
                                <h1>ÊñáÁ´†ÁÆ°ÁêÜ</h1>
                                <button @click="showEditor = true; editingArticle = null" class="btn btn-primary">Êñ∞Âª∫ÊñáÁ´†</button>
                            </div>
                            <div class="article-table">
                                <div class="table-header">
                                    <span>Ê†áÈ¢ò</span>
                                    <span>ÂàÜÁ±ª</span>
                                    <span>Áä∂ÊÄÅ</span>
                                    <span>ÈòÖËØª</span>
                                    <span>ÂèëÂ∏ÉÊó∂Èó¥</span>
                                    <span>Êìç‰Ωú</span>
                                </div>
                                <div v-if="allArticles.length > 0" class="table-body">
                                    <div v-for="article in allArticles" :key="article.id" class="table-row">
                                        <span class="title-cell">[[article.title]]</span>
                                        <span>[[article.category_name || '-']]</span>
                                        <span>
                                            <span class="status-badge" :class="article.status">
                                                [[article.status === 'published' ? 'Â∑≤ÂèëÂ∏É' : 'ËçâÁ®ø']]
                                            </span>
                                        </span>
                                        <span>[[article.view_count]]</span>
                                        <span>[[formatShortDate(article.published_at)]]</span>
                                        <span class="actions">
                                            <button @click="editArticle(article)" class="btn-icon" title="ÁºñËæë">
                                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/></svg>
                                            </button>
                                            <button v-if="article.status === 'draft'" @click="publishArticle(article)" class="btn-icon" title="ÂèëÂ∏É">
                                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>
                                            </button>
                                            <button v-else @click="unpublishArticle(article)" class="btn-icon" title="‰∏ãÊû∂">
                                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
                                            </button>
                                            <button @click="deleteArticle(article)" class="btn-icon danger" title="Âà†Èô§">
                                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/></svg>
                                            </button>
                                        </span>
                                    </div>
                                </div>
                                <div v-else class="table-empty">
                                    <p>ÊöÇÊó†ÊñáÁ´†</p>
                                </div>
                            </div>
                        </div>

                        <!-- ÂàÜÁ±ªÁÆ°ÁêÜ -->
                        <div v-else-if="adminSection === 'categories'" class="admin-section">
                            <div class="section-header">
                                <h1>ÂàÜÁ±ªÁÆ°ÁêÜ</h1>
                                <button @click="showCategoryForm = true" class="btn btn-primary">Êñ∞Âª∫ÂàÜÁ±ª</button>
                            </div>
                            <div class="category-list">
                                <div v-for="cat in categories" :key="cat.id" class="category-item">
                                    <div class="category-info">
                                        <span class="category-name">[[cat.name]]</span>
                                        <span class="category-slug">[[cat.slug]]</span>
                                    </div>
                                    <div class="category-actions">
                                        <button @click="editCategory(cat)" class="btn btn-small btn-secondary">ÁºñËæë</button>
                                        <button @click="deleteCategory(cat)" class="btn btn-small btn-danger">Âà†Èô§</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Áî®Êà∑ÁÆ°ÁêÜ -->
                        <div v-else-if="adminSection === 'users'" class="admin-section">
                            <div class="section-header">
                                <h1>Áî®Êà∑ÁÆ°ÁêÜ</h1>
                            </div>
                            <div class="user-table">
                                <div class="table-header">
                                    <span>Áî®Êà∑Âêç</span>
                                    <span>ÈÇÆÁÆ±</span>
                                    <span>ËßíËâ≤</span>
                                    <span>Áä∂ÊÄÅ</span>
                                    <span>Ê≥®ÂÜåÊó∂Èó¥</span>
                                    <span>Êìç‰Ωú</span>
                                </div>
                                <div v-if="users.length > 0" class="table-body">
                                    <div v-for="userItem in users" :key="userItem.id" class="table-row">
                                        <span>[[userItem.username]]</span>
                                        <span>[[userItem.email]]</span>
                                        <span>
                                            <span class="role-badge" :class="userItem.role">
                                                [[userItem.role === 'admin' ? 'ÁÆ°ÁêÜÂëò' : 'ÊôÆÈÄöÁî®Êà∑']]
                                            </span>
                                        </span>
                                        <span>
                                            <span class="status-badge" :class="{ active: userItem.is_active }">
                                                [[userItem.is_active ? 'ÂêØÁî®' : 'Á¶ÅÁî®']]
                                            </span>
                                        </span>
                                        <span>[[formatShortDate(userItem.created_at)]]</span>
                                        <span class="actions">
                                            <button v-if="userItem.id !== user.id" @click="toggleUser(userItem)" class="btn btn-small btn-secondary">
                                                [[userItem.is_active ? 'Á¶ÅÁî®' : 'ÂêØÁî®']]
                                            </button>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </main>
                </div>
            </div>
        </div>
    </main>

    <!-- ÊñáÁ´†ÁºñËæëÂô®ÂºπÁ™ó -->
    <div v-if="showEditor" class="modal-overlay" @click.self="showEditor = false">
        <div class="modal-content editor-modal">
            <div class="modal-header">
                <h2>[[editingArticle ? 'ÁºñËæëÊñáÁ´†' : 'Êñ∞Âª∫ÊñáÁ´†']]</h2>
                <button @click="showEditor = false" class="modal-close">&times;</button>
            </div>
            <form @submit.prevent="saveArticle">
                <div class="form-group">
                    <label>Ê†áÈ¢ò</label>
                    <input type="text" v-model="articleForm.title" class="form-control" required>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>ÂàÜÁ±ª</label>
                        <select v-model="articleForm.category_id" class="form-control">
                            <option :value="null">Êó†ÂàÜÁ±ª</option>
                            <option v-for="cat in categories" :key="cat.id" :value="cat.id">[[cat.name]]</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Áä∂ÊÄÅ</label>
                        <select v-model="articleForm.status" class="form-control">
                            <option value="draft">ËçâÁ®ø</option>
                            <option value="published">ÂèëÂ∏É</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>
                        ÂÜÖÂÆπ (Markdown)
                        <button type="button" @click="showPreview = !showPreview" class="preview-toggle-btn">
                            [[showPreview ? 'ÈöêËóèÈ¢ÑËßà' : 'ÊòæÁ§∫È¢ÑËßà']]
                        </button>
                    </label>
                    <div class="editor-with-preview" :class="{ 'preview-active': showPreview }">
                        <textarea v-model="articleForm.content" class="form-control editor-textarea" rows="15" required placeholder="‰ΩøÁî® Markdown Ê†ºÂºèÁºñÂÜô..."></textarea>
                        <div v-if="showPreview" class="markdown-preview" v-html="previewHtml"></div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" @click="showEditor = false" class="btn btn-secondary">ÂèñÊ∂à</button>
                    <button type="submit" class="btn btn-primary" :disabled="submitting">
                        [[submitting ? '‰øùÂ≠ò‰∏≠...' : '‰øùÂ≠ò']]
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- ÂàÜÁ±ªË°®ÂçïÂºπÁ™ó -->
    <div v-if="showCategoryForm" class="modal-overlay" @click.self="showCategoryForm = false">
        <div class="modal-content">
            <div class="modal-header">
                <h2>[[editingCategory ? 'ÁºñËæëÂàÜÁ±ª' : 'Êñ∞Âª∫ÂàÜÁ±ª']]</h2>
                <button @click="showCategoryForm = false" class="modal-close">&times;</button>
            </div>
            <form @submit.prevent="saveCategory">
                <div class="form-group">
                    <label>ÂàÜÁ±ªÂêçÁß∞</label>
                    <input type="text" v-model="categoryForm.name" class="form-control" required>
                </div>
                <div class="form-group">
                    <label>Slug</label>
                    <input type="text" v-model="categoryForm.slug" class="form-control">
                </div>
                <div class="form-group">
                    <label>ÊèèËø∞</label>
                    <textarea v-model="categoryForm.description" class="form-control" rows="2"></textarea>
                </div>
                <div class="modal-footer">
                    <button type="button" @click="showCategoryForm = false" class="btn btn-secondary">ÂèñÊ∂à</button>
                    <button type="submit" class="btn btn-primary">‰øùÂ≠ò</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ÁßªÂä®Á´ØÂ∫ïÈÉ®ÂØºËà™ -->
    <nav class="mobile-bottom-nav">
        <a href="/" :class="{ active: currentPage === 'home' }">
            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>
            È¶ñÈ°µ
        </a>
        <a href="#" @click.prevent="scrollToSearch">
            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>
            ÊêúÁ¥¢
        </a>
        <template v-if="isLoggedIn">
            <a href="/profile" :class="{ active: currentPage === 'profile' }">
                <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
                ÊàëÁöÑ
            </a>
            <a href="/admin" v-if="isAdmin" :class="{ active: currentPage === 'admin' }">
                <svg viewBox="0 0 24 24" fill="currentColor"><path d="M19.14 12.94c.04-.31.06-.63.06-.94 0-.31-.02-.63-.06-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/></svg>
                ÁÆ°ÁêÜ
            </a>
        </template>
        <template v-else>
            <a href="/login">
                <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
                ÁôªÂΩï
            </a>
        </template>
    </nav>

    <footer class="footer">
        <p>&copy; 2026 news.docms.nz - ÁßëÊäÄÊñ∞ÈóªÂàÜ‰∫´Âπ≥Âè∞</p>
    </footer>
</div>
{% endraw %}

<script src="/static/lib/vue.min.js"></script>
<script src="/static/lib/marked.min.js"></script>
<script>
// Simple auth state management
const authState = Vue.reactive({
    user: JSON.parse(localStorage.getItem('user') || 'null'),
    token: localStorage.getItem('access_token') || null,
    get isLoggedIn() { return !!this.token; },
    get isAdmin() { return this.user?.role === 'admin'; },
    setUser(user, token) {
        this.user = user;
        this.token = token;
        localStorage.setItem('user', JSON.stringify(user));
        localStorage.setItem('access_token', token);
    },
    logout() {
        this.user = null;
        this.token = null;
        localStorage.removeItem('user');
        localStorage.removeItem('access_token');
        localStorage.removeItem('refresh_token');
    }
});

const api = {
    async request(url, options = {}) {
        const token = localStorage.getItem('access_token');
        const headers = { 'Content-Type': 'application/json' };
        if (token) headers['Authorization'] = 'Bearer ' + token;
        const response = await fetch('/api' + url, { ...options, headers: { ...headers, ...options.headers } });
        const data = await response.json();
        if (!response.ok) throw new Error(data.error || 'ËØ∑Ê±ÇÂ§±Ë¥•');
        return { data };
    },
    get(url, params = {}) {
        const query = new URLSearchParams(params).toString();
        return this.request(query ? url + '?' + query : url);
    },
    post(url, data) {
        return this.request(url, { method: 'POST', body: JSON.stringify(data) });
    },
    put(url, data) {
        return this.request(url, { method: 'PUT', body: JSON.stringify(data) });
    },
    delete(url) {
        return this.request(url, { method: 'DELETE' });
    }
};

const app = Vue.createApp({
    delimiters: ['[[', ']]'],
    setup() {
        // Áä∂ÊÄÅ
        const currentPage = Vue.ref('home');
        const articles = Vue.ref([]);
        const article = Vue.ref(null);
        const categories = Vue.ref([]);
        const allArticles = Vue.ref([]);
        const users = Vue.ref([]);
        const recentArticles = Vue.ref([]);
        const stats = Vue.ref({ total_users: 0, total_articles: 0, published_articles: 0, draft_articles: 0 });
        const totalPages = Vue.ref(1);
        const currentPageNum = Vue.ref(1);
        const selectedCategory = Vue.ref(null);
        const error = Vue.ref('');
        const successMessage = Vue.ref('');
        const loading = Vue.ref(false);
        const submitting = Vue.ref(false);
        const mobileMenuOpen = Vue.ref(false);
        const searchQuery = Vue.ref('');

        // Êñ∞Â¢ûÁä∂ÊÄÅ
        const toasts = Vue.ref([]);
        const readingProgress = Vue.ref(0);
        const searchSuggestions = Vue.ref([]);
        const showSearchSuggestions = Vue.ref(false);
        const tocItems = Vue.ref([]);
        const activeToc = Vue.ref('');
        const articleContent = Vue.ref(null);

        // Ë°®ÂçïÊï∞ÊçÆ
        const loginForm = Vue.ref({ username: '', password: '' });
        const registerForm = Vue.ref({ username: '', email: '', password: '' });
        const articleForm = Vue.ref({ title: '', content: '', category_id: null, status: 'draft' });
        const categoryForm = Vue.ref({ name: '', slug: '', description: '' });

        // ÁºñËæëÂô®Áä∂ÊÄÅ
        const showEditor = Vue.ref(false);
        const showCategoryForm = Vue.ref(false);
        const editingArticle = Vue.ref(null);
        const editingCategory = Vue.ref(null);
        const adminSection = Vue.ref('dashboard');
        const showPreview = Vue.ref(false);

        // Markdown È¢ÑËßàËÆ°ÁÆóÂ±ûÊÄß
        const previewHtml = Vue.computed(() => {
            if (!articleForm.value.content) return '<p class="preview-placeholder">È¢ÑËßàÂ∞ÜÂú®Ê≠§Â§ÑÊòæÁ§∫...</p>';
            return marked.parse(articleForm.value.content);
        });

        // Ë∑ØÁî±Â§ÑÁêÜ
        const handleRouteChange = () => {
            const path = window.location.pathname;
            mobileMenuOpen.value = false;

            if (path === '/' || path.startsWith('/page/')) {
                currentPage.value = 'home';
                const page = path === '/' ? 1 : parseInt(path.split('/')[2]) || 1;
                currentPageNum.value = page;
                fetchArticles(page);
            } else if (path.startsWith('/article/')) {
                currentPage.value = 'article';
                fetchArticle(path.split('/')[2]);
            } else if (path === '/login') {
                currentPage.value = 'login';
            } else if (path === '/register') {
                currentPage.value = 'register';
            } else if (path === '/profile') {
                currentPage.value = 'profile';
            } else if (path === '/admin') {
                if (!authState.isAdmin) {
                    window.location.href = '/login';
                    return;
                }
                currentPage.value = 'admin';
                fetchAdminData();
            }
        };

        const navigateTo = (path) => {
            window.history.pushState({}, '', path);
            handleRouteChange();
        };

        // Êï∞ÊçÆËé∑Âèñ
        const fetchArticles = async (page = 1) => {
            try {
                loading.value = true;
                const params = { page, per_page: 10 };
                if (selectedCategory.value) params.category_id = selectedCategory.value;
                if (searchQuery.value) params.search = searchQuery.value;
                const r = await api.get('/articles', params);
                articles.value = r.data.articles;
                totalPages.value = r.data.pages;
            } catch (e) {
                error.value = e.message;
            } finally {
                loading.value = false;
            }
        };

        const fetchArticle = async (slug) => {
            try {
                loading.value = true;
                const r = await api.get('/articles/' + slug);
                article.value = r.data.article;
            } catch (e) {
                error.value = e.message;
            } finally {
                loading.value = false;
            }
        };

        const fetchCategories = async () => {
            try {
                const r = await api.get('/categories');
                categories.value = r.data.categories;
            } catch (e) {}
        };

        const fetchStats = async () => {
            try {
                const r = await api.get('/admin/dashboard');
                stats.value = r.data.stats;
                recentArticles.value = r.data.recent_articles;
            } catch (e) {}
        };

        const fetchAdminData = async () => {
            try {
                const [articlesRes, usersRes] = await Promise.all([
                    api.get('/articles', { status: null, per_page: 100 }),
                    api.get('/admin/users')
                ]);
                allArticles.value = articlesRes.data.articles;
                users.value = usersRes.data.users;
            } catch (e) {}
        };

        // Êìç‰Ωú
        const filterByCategory = (catId) => {
            selectedCategory.value = catId;
            fetchArticles(1);
        };

        const handleSearch = () => {
            fetchArticles(1);
        };

        const clearSearch = () => {
            searchQuery.value = '';
            fetchArticles(1);
        };

        const goToPage = (page) => {
            navigateTo(page === 1 ? '/' : '/page/' + page);
        };

        const handleLogin = async () => {
            error.value = '';
            submitting.value = true;
            try {
                const r = await api.post('/auth/login', loginForm.value);
                localStorage.setItem('refresh_token', r.data.refresh_token);
                authState.setUser(r.data.user, r.data.access_token);
                navigateTo('/');
            } catch (e) {
                error.value = e.message;
            } finally {
                submitting.value = false;
            }
        };

        const handleRegister = async () => {
            error.value = '';
            submitting.value = true;
            try {
                const r = await api.post('/auth/register', registerForm.value);
                localStorage.setItem('refresh_token', r.data.refresh_token);
                authState.setUser(r.data.user, r.data.access_token);
                navigateTo('/');
            } catch (e) {
                error.value = e.message;
            } finally {
                submitting.value = false;
            }
        };

        const logout = async () => {
            try { await api.post('/auth/logout'); } catch (e) {}
            authState.logout();
            navigateTo('/');
        };

        const editArticle = (art) => {
            editingArticle.value = art;
            articleForm.value = {
                title: art.title,
                content: art.content,
                category_id: art.category_id,
                status: art.status
            };
            showEditor.value = true;
        };

        const saveArticle = async () => {
            submitting.value = true;
            try {
                if (editingArticle.value) {
                    await api.put('/articles/' + editingArticle.value.slug, articleForm.value);
                } else {
                    await api.post('/articles', articleForm.value);
                }
                showEditor.value = false;
                editingArticle.value = null;
                articleForm.value = { title: '', content: '', category_id: null, status: 'draft' };
                await fetchAdminData();
                await fetchStats();
                await fetchArticles(currentPageNum.value);
                successMessage.value = '‰øùÂ≠òÊàêÂäü';
            } catch (e) {
                error.value = e.message;
            } finally {
                submitting.value = false;
            }
        };

        const publishArticle = async (art) => {
            try {
                await api.post('/articles/' + art.slug + '/publish');
                await fetchAdminData();
                await fetchStats();
            } catch (e) {
                error.value = e.message;
            }
        };

        const unpublishArticle = async (art) => {
            try {
                await api.post('/articles/' + art.slug + '/unpublish');
                await fetchAdminData();
                await fetchStats();
            } catch (e) {
                error.value = e.message;
            }
        };

        const deleteArticle = async (art) => {
            if (!confirm('Á°ÆÂÆöÂà†Èô§ËøôÁØáÊñáÁ´†ÂêóÔºü')) return;
            try {
                await api.delete('/articles/' + art.slug);
                await fetchAdminData();
                await fetchStats();
                await fetchArticles(currentPageNum.value);
            } catch (e) {
                error.value = e.message;
            }
        };

        const editCategory = (cat) => {
            editingCategory.value = cat;
            categoryForm.value = { ...cat };
            showCategoryForm.value = true;
        };

        const saveCategory = async () => {
            try {
                if (editingCategory.value) {
                    await api.put('/categories/' + editingCategory.value.id, categoryForm.value);
                } else {
                    await api.post('/categories', categoryForm.value);
                }
                showCategoryForm.value = false;
                editingCategory.value = null;
                categoryForm.value = { name: '', slug: '', description: '' };
                await fetchCategories();
            } catch (e) {
                error.value = e.message;
            }
        };

        const deleteCategory = async (cat) => {
            if (!confirm('Á°ÆÂÆöÂà†Èô§Ê≠§ÂàÜÁ±ªÂêóÔºü')) return;
            try {
                await api.delete('/categories/' + cat.id);
                await fetchCategories();
            } catch (e) {
                error.value = e.message;
            }
        };

        const toggleUser = async (userItem) => {
            try {
                await api.post('/admin/users/' + userItem.id + '/toggle-active');
                await fetchAdminData();
            } catch (e) {
                error.value = e.message;
            }
        };

        // Toast ÈÄöÁü•Á≥ªÁªü
        const addToast = (title, message, type = 'info', duration = 4000) => {
            const id = Date.now();
            toasts.value.push({ id, title, message, type });
            if (duration > 0) {
                setTimeout(() => removeToast(id), duration);
            }
        };

        const removeToast = (id) => {
            const index = toasts.value.findIndex(t => t.id === id);
            if (index > -1) toasts.value.splice(index, 1);
        };

        // ÈòÖËØªÊó∂Èó¥ËÆ°ÁÆó
        const calculateReadTime = (content) => {
            if (!content) return '1ÂàÜÈíü';
            const wordsPerMinute = 200;
            const words = content.replace(/<[^>]*>/g, '').replace(/[#*`]/g, '').length;
            const minutes = Math.max(1, Math.ceil(words / (wordsPerMinute / 2)));
            return minutes + 'ÂàÜÈíüÈòÖËØª';
        };

        // ÊêúÁ¥¢Âª∫ËÆÆ
        let searchTimeout = null;
        const handleSearchInput = () => {
            if (searchTimeout) clearTimeout(searchTimeout);
            if (searchQuery.value.length < 2) {
                searchSuggestions.value = [];
                showSearchSuggestions.value = false;
                return;
            }
            searchTimeout = setTimeout(async () => {
                try {
                    const r = await api.get('/articles', { search: searchQuery.value, per_page: 5 });
                    searchSuggestions.value = r.data.articles || [];
                    showSearchSuggestions.value = searchSuggestions.value.length > 0;
                } catch (e) {
                    searchSuggestions.value = [];
                }
            }, 300);
        };

        const selectSuggestion = (suggestion) => {
            searchQuery.value = suggestion.title;
            showSearchSuggestions.value = false;
            navigateTo('/article/' + suggestion.slug);
        };

        // ÁõÆÂΩïÁîüÊàê
        const generateToc = () => {
            if (!articleContent.value) return;
            const headings = articleContent.value.querySelectorAll('h2, h3');
            tocItems.value = Array.from(headings).map((heading, index) => {
                const id = heading.id || 'heading-' + index;
                heading.id = id;
                return {
                    id,
                    text: heading.textContent,
                    level: parseInt(heading.tagName.charAt(1))
                };
            });
        };

        // ÈòÖËØªËøõÂ∫¶
        const updateReadingProgress = () => {
            if (currentPage.value !== 'article') return;
            const scrollTop = window.scrollY || document.documentElement.scrollTop;
            const docHeight = document.documentElement.scrollHeight - window.innerHeight;
            const progress = (scrollTop / docHeight) * 100;
            readingProgress.value = Math.min(100, Math.max(0, progress));
        };

        // È´ò‰∫ÆÂΩìÂâçÁõÆÂΩï
        const updateActiveToc = () => {
            const headings = document.querySelectorAll('.article-content h2, .article-content h3');
            for (let i = headings.length - 1; i >= 0; i--) {
                const rect = headings[i].getBoundingClientRect();
                if (rect.top < 150) {
                    activeToc.value = headings[i].id;
                    break;
                }
            }
        };

        // ÊªöÂä®Âà∞ÊåáÂÆöÊ†áÈ¢ò
        const scrollToHeading = (id) => {
            const element = document.getElementById(id);
            if (element) {
                element.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        };

        // ÂõûÂà∞È°∂ÈÉ®
        const scrollToTop = () => {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        };

        // ÊªöÂä®Âà∞ÊêúÁ¥¢Ê°Ü
        const scrollToSearch = () => {
            const searchBox = document.querySelector('.search-box');
            if (searchBox) {
                searchBox.scrollIntoView({ behavior: 'smooth', block: 'center' });
                searchBox.querySelector('input').focus();
            }
        };

        // ÂàÜ‰∫´ÂäüËÉΩ
        const shareArticle = (platform) => {
            const url = window.location.href;
            const title = article.value?.title || document.title;
            const shareData = { url, title };

            if (platform === 'link') {
                navigator.clipboard.writeText(url).then(() => {
                    addToast('ÈìæÊé•Â∑≤Â§çÂà∂', 'ÊñáÁ´†ÈìæÊé•Â∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø', 'success');
                });
            } else if (platform === 'weibo') {
                const weiboUrl = `https://service.weibo.com/share/share.php?url=${encodeURIComponent(url)}&title=${encodeURIComponent(title)}`;
                window.open(weiboUrl, '_blank');
            } else if (platform === 'twitter') {
                const twitterUrl = `https://twitter.com/intent/tweet?url=${encodeURIComponent(url)}&text=${encodeURIComponent(title)}`;
                window.open(twitterUrl, '_blank');
            }
        };

        // ËÆæÁΩÆÊªöÂä®ÁõëÂê¨
        Vue.onMounted(async () => {
            const token = localStorage.getItem('access_token');
            if (token) {
                try {
                    const r = await api.get('/auth/me');
                    authState.setUser(r.data.user, token);
                } catch (e) {
                    authState.logout();
                }
            }
            await Promise.all([fetchCategories(), fetchStats()]);
            handleRouteChange();
            window.addEventListener('popstate', handleRouteChange);
            window.addEventListener('scroll', updateReadingProgress);
            window.addEventListener('scroll', updateActiveToc);

            // ÁÇπÂáªÂ§ñÈÉ®ÂÖ≥Èó≠ÊêúÁ¥¢Âª∫ËÆÆ
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.search-box')) {
                    showSearchSuggestions.value = false;
                }
            });

            // ÊñáÁ´†È°µÈù¢Âä†ËΩΩÂêéÁîüÊàêÁõÆÂΩï
            if (currentPage.value === 'article') {
                setTimeout(generateToc, 500);
            }
        });

        // Êó•ÊúüÊ†ºÂºèÂåñ
        const formatDate = (dateStr) => {
            if (!dateStr) return '';
            return new Date(dateStr).toLocaleDateString('zh-CN');
        };

        const formatFullDate = (dateStr) => {
            if (!dateStr) return '';
            return new Date(dateStr).toLocaleString('zh-CN');
        };

        const formatShortDate = (dateStr) => {
            if (!dateStr) return '-';
            return new Date(dateStr).toLocaleDateString('zh-CN', { month: 'short', day: 'numeric' });
        };

        return {
            currentPage, articles, article, categories, allArticles, users, recentArticles, stats,
            totalPages, currentPageNum, selectedCategory, error, successMessage, loading, submitting,
            mobileMenuOpen, searchQuery, loginForm, registerForm, articleForm, categoryForm,
            showEditor, showCategoryForm, editingArticle, editingCategory, adminSection, showPreview, previewHtml,
            // Êñ∞Â¢ûÁä∂ÊÄÅ
            toasts, readingProgress, searchSuggestions, showSearchSuggestions, tocItems, activeToc, articleContent,
            // ËÆ°ÁÆóÂ±ûÊÄß
            isLoggedIn: Vue.computed(() => authState.isLoggedIn),
            isAdmin: Vue.computed(() => authState.isAdmin),
            user: Vue.computed(() => authState.user),
            // ÊñπÊ≥ï
            filterByCategory, handleSearch, clearSearch, goToPage, handleLogin, handleRegister, logout,
            editArticle, saveArticle, publishArticle, unpublishArticle, deleteArticle,
            editCategory, saveCategory, deleteCategory, toggleUser,
            formatDate, formatFullDate, formatShortDate,
            // Êñ∞Â¢ûÊñπÊ≥ï
            calculateReadTime, handleSearchInput, selectSuggestion, scrollToHeading,
            scrollToTop, scrollToSearch, shareArticle, removeToast, addToast
        };
    }
});

// Auto-mount on page load
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => {
        app.mount('#app');
    });
} else {
    app.mount('#app');
}
</script>
</body>
</html>
